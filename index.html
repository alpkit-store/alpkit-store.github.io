<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Alpkit Store · Repos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }
    details { border: 1px solid #ddd; border-radius: 12px; padding: 0.75rem 1rem; margin: 0.75rem 0; }
    summary { cursor: pointer; font-weight: 650; }
    .links { margin-top: 0.35rem; font-size: 0.95rem; opacity: 0.9; }
    .readme { margin-top: 0.75rem; }
    pre { overflow: auto; padding: 0.75rem; background: #f6f8fa; border-radius: 10px; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
  <script src="./assets/marked.min.js"></script>
</head>
<body>
  <h1>Selected Repos</h1>
  <div id="list">Loading…</div>

  <script>
  (function () {
    var ORG = "alpkit-store";

    function fetchJSON(path) {
      return fetch(path, { cache: "no-store" }).then(function (res) {
        return res.text().then(function (text) {
          if (!res.ok) throw new Error(path + " -> " + res.status + "\n" + text.slice(0, 200));
          return JSON.parse(text);
        });
      });
    }

    function loadText(path) {
      return fetch(path, { cache: "no-store" }).then(function (res) {
        if (!res.ok) return null;
        return res.text();
      });
    }

    var list = document.getElementById("list");
    list.textContent = "Loading…";

    // sanity: confirm marked is available
    if (typeof window.marked === "undefined") {
      list.innerHTML = "<pre>marked is undefined (script failed to load)</pre>";
      return;
    }

    fetchJSON("./repos.json").then(function (cfg) {
      list.innerHTML = "";

      if (!cfg.repos || !cfg.repos.length) {
        list.innerHTML = "<em>No repos listed in repos.json</em>";
        return;
      }

      cfg.repos.forEach(function (name) {
        var d = document.createElement("details");

        var summary = document.createElement("summary");
        summary.textContent = name;
        d.appendChild(summary);

        var links = document.createElement("div");
        links.className = "links";

        var aRepo = document.createElement("a");
        aRepo.href = "https://github.com/" + ORG + "/" + name;
        aRepo.target = "_blank";
        aRepo.rel = "noreferrer";
        aRepo.textContent = "Open repo";

        var sep = document.createTextNode(" · ");

        var aMd = document.createElement("a");
        aMd.href = "./readmes/" + name + "/README.md";
        aMd.target = "_blank";
        aMd.rel = "noreferrer";
        aMd.textContent = "View synced README.md";

        links.appendChild(aRepo);
        links.appendChild(sep);
        links.appendChild(aMd);
        d.appendChild(links);

        var readme = document.createElement("div");
        readme.className = "readme";
        readme.innerHTML = "<em>Expand to load README…</em>";
        d.appendChild(readme);

        d.addEventListener("toggle", function () {
          if (!d.open) return;
          if (readme.dataset.loaded) return;

          loadText("./readmes/" + name + "/README.md").then(function (md) {
            readme.innerHTML = md ? window.marked.parse(md) : "<em>No README synced yet.</em>";
            readme.dataset.loaded = "1";
          }).catch(function (err) {
            readme.innerHTML = "<pre>" + String(err.message || err) + "</pre>";
          });
        });

        list.appendChild(d);
      });
    }).catch(function (err) {
      list.innerHTML = "<pre style='white-space:pre-wrap'>" + String(err.message || err) + "</pre>";
    });
  })();
</script>


</body>
</html>